#
## Day4  오류 메시지 표준화 및 비즈니스 예외 처리(Talend 기반)
* 강의 목포   
API 오류 메시지 포맷을 일관되게 구성  
비즈니스 로직 예외 처리 전략 학습  
커스텀 예외 정의 및 Talend로 테스트  
  
* 강의 내용  
1. 오류 응다 메시지 표준화의 중요성  
2. 예외 응답 포맷 설계 : status, error, message, timestamp  
3. 커스텀 예외 클래스 정의(예: PostNotFoundException)  
4. 커스텀 예외 처리기에서 커스텀 예외 처리  
5. Talend API Tester로 비즈니스 예외 상황 테스트  
  
* 실습코드 : 비즈니스 예외 처리 적용 - 예외 클래스 만들기  
  
* PostNotFoundException.java

      Package com.exmaple.board.exception;
      public class PostNotFoundException extends RuntimeException{
        public PostNotFoundException(String message){
          super(message);
        }
      }

* PostSerice.java(예외 추가)

      package com.example.board.service;

      import com.exmaple.board.dto.PostReqeustDto;
      import com.example.board.exception.PostNotFoundException;
      import org.springframework.streotype.Service;

      @Service
      public class PostService{
        public void createPost(PostRequestDTO dto){
          System.out.println("제목 : "+dto.getTile());
          System.out.println("내용 : "+dto.getContent());
        }
        public String getPost(Long id){
          //DB  연동 전이므로 무조건 에러 처리
          throw new PostNotFoundException("해당 게시글을 찾을 수 없습니다. id="+id)
        }
      }

* PostController.java(조회 API 추가)

      public ResponseEntity<String> get(@PathVariable Long id){
        String post = postService.getPost(id);
        return ResponseEntity.ok;
      }

* GlobalExceptionHandler.java(예외 포맷 표준화)

      public RespnseEntity<Map<String, Object>> handlePostNotFound(PostNotFoundException ex){
        Map<String, Object> error = new HashMap<>();
        error.put("status", 404);
        error.put("error", "Not Found");
        error.put("message", ex.getMessage());
        error.put("timestamp", LocalDateTime.now());
        return ResponseEntity.status(404).body(error);
      }

## Day 4 과제 
> Day 4 과제

1. PostNotFoundException 클래스를 작성하고 PostService의 getPost()에 적용해보세요.

// PostNotFoundException.java

      package com.example.board.exception;
      public class PostNotFoundException extends RuntimeException {
        public PostNotFoundException(String message) {
          super(messge);
        }
      }

     
  // PostService.java

     package com.example.board.service;
     
     import com.example.board.exception.PostNotFoundException;
     import org.springframework.stereotype.Service;

     @Service
     public class PostService {
      public String getPost(Long id) {
        // 실제 DB 조회 로직 대신 예외 발생
        throw new PostNotFoundException("해당 게시글을 찾을 수 없습니다. id = " + id);
      }
     }

     
  // PostController.java

     @GetMapping("/posts/{id}")
     public ResponseEntity<String> getPost(@PathVariable Long id) {
      String result = postService.getPost(id);
      return ResponseEntity.ok(result);
     }

2. Talend에서 /posts/100과 같은 존재하지 않는 게시글을 조회 요청하여 404 응답 메시지를 확인하세요.

     요청: GET http://localhost:8080/posts/100
     결과: HTTP 404 + JSON 응답


3. 응답 포맷에 포함된 필드가 status, error, message, timestamp 모두 포함되도록 설정하세요.

        // GlobalExceptionHandler.java

        package com.example.board.exception;

        import org.springframework.http.HttpStatus;
        import org.springframework.http.ResponseEntity;
        import org.springframework.web.bind.annotation.ExceptionHandler;
        import org.springframework.web.bind.annotation.RestControllerAdvice;

        import java.time.LocalDateTime;
        import java.util.HashMap;
        import java.util.Map;

        @RestControllerAdvice
        public class GlobalExceptionHandler {
          @ExceptionHandler(PostNotFoundException.class)
          public ResponseEntity<Map<String, Object>> handlePostNotFound(PostNotFoundException ex) {
            Map<String, Object> body = new HashMap<>();
            body.put("status", HttpStatus.NOT_FOUND.value());
            body.put("error", "Not Found");
            body.put("message", ex.getMessage());
            body.put("timestamp", LocalDateTime.now());

            return ResponseEntity.status(HttpStatus.NOT_FOUND).body(body);
          }

        }
      
---> 응답 JSON 예시

          {
            "status" : 404,
            "error" : "Not Found",
            "message" : "해당 게시글을 찾을 수 없습니다. id=100",
            "timestamp" : "2025-08-01T14:20:43:921"	  
            }


4. API 오류 응답을 일관되게 구성하면 어떤 장점이 있는지 정리문서를 작성해보세요.   
   
     구조 일관성 --> 모든 예외 응답이 동일한 구조로 제공되어 프론트엔드 처리 용이   
     디버깅 용이성 --> 어떤 오류인지 메시지 필드로 명확하게 전달   
     시간 확인 가능 --> timestamp 포함으로 문제 발생 시각 추적 가능   
     보안 고려 가능 --> 내부 오류 메시지 노출 방지 및 컨트롤 기능   
   
소스 간결   
불필요한 DB 처리 제한   
사용자에 오류 내용 전달 가능   
   
   
## Day 4 코딩 실습형 문제 10문제
   
문제 1   
PostNotFoundException이라는 이름의 사용자 정의 예외 클래스를 생성하고, RuntimeException을 상속받도록 구현하세요.   

문제 2   
PostService 클래스에서 getPost(Long id) 메서드를 작성하고, 해당 메서드 내부에서 무조건 PostNotFoundException을 발생시키도록 하세요.   

문제 3   
PostController 클래스에 /posts/{id} 경로로 GET 요청을 처리하는 메서드를 추가하고, 위의 getPost()를 호출하도록 하세요.   
   
문제 4   
GlobalExceptionHandler 클래스를 생성하고, @RestControllerAdvice 어노테이션을 사용하여 전역 예외 처리기로 등록하세요.   
   
문제 5   
GlobalExceptionHandler에 @ExceptionHandler(PostNotFoundException.class) 메서드를 작성하고, 다음 정보를 담은 JSON 응답을 구성하세요:   
status   
error   
message   
timestamp   


문제 6
LocalDateTime.now()를 사용하여 예외 발생 시점의 시간 정보도 함께 응답에 포함되도록    구현하세요.   

문제 7   
Talend API Tester를 이용해 존재하지 않는 게시글 ID(/posts/999)를 요청하고, 응답 상태    코드가 404인지 확인하세요.   

문제 8   
Talend 응답 결과에서 JSON 응답 구조가 아래 형식을 따르고 있는지 확인하세요:   

    {
      "status": 404,
      "error": "Not Found",
      "message": "해당 게시글을 찾을 수 없습니다. id=999",
      "timestamp": "2025-07-30T11:35:00"
    }


문제 9   
응답 포맷을 프론트엔드 개발자가 사용하기 쉽도록 구성했는지 점검해보고, message 필드가 사용자 친화적으로 작성되었는지 검토하세요.   

문제 10   
정리 보고서를 작성하세요. 내용에는 다음을 포함해야 합니다:   
예외 메시지를 표준화했을 때의 장점 3가지   


timestamp 필드를 포함하는 이유   


@RestControllerAdvice를 사용하는 이점   


## i18n message 프로퍼티
message.peoperties를 언어별로 만들고  intercepter에서 lang 파라미터를 받아서 처리해주면 된다.   

* LocaleConfig.java

      package com.example.restful.config;

      import org.springframework.context.annotation.Bean;
      import org.springframework.context.annotation.Configuration;
      import org.springframework.web.servlet.LocaleResolver;
      import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
      import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
      import org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver;
      import org.springframework.web.servlet.i18n.LocaleChangeInterceptor;
      import org.springframework.web.servlet.i18n.SessionLocaleResolver;

      import java.util.List;
      import java.util.Locale;

      @Configuration
      public class LocaleConfig implements WebMvcConfigurer {

          @Bean
          public LocaleResolver localeResolver(){
              SessionLocaleResolver slr = new SessionLocaleResolver();
              slr.setDefaultLocale(Locale.KOREAN);
              return slr;
          }


          @Bean
          public LocaleChangeInterceptor localeChangeInterceptor() {
              LocaleChangeInterceptor interceptor = new LocaleChangeInterceptor();
              interceptor.setParamName("lang"); // 예: /hello?lang=en
              interceptor.setIgnoreInvalidLocale(true);
              return interceptor;
          }

          //인터셉터에 추가해준다.
          @Override
          public void addInterceptors(InterceptorRegistry registry) {
              registry.addInterceptor(localeChangeInterceptor())
                      .excludePathPatterns("/css/**", "/js/**", "/images/**", "/fonts/**")
                      .addPathPatterns("/**");
          }

      }


* /resources/message.properties

      spring.messages.encoding=UTF-8
      greeting=안녕하세요
      farewell=굿바이
      nodata=데이터가 없습니다.~~



* /resources/message_en.properties

      spring.messages.encoding=UTF-8
      greeting=Hello!
      farewell=Goodbye!
      nodata=no data. Are you ok?


* MessageUtil.java

      package com.example.restful.util;

      import org.springframework.context.MessageSource;
      import org.springframework.context.i18n.LocaleContextHolder;
      import org.springframework.stereotype.Component;

      @Component
      public class MessageUtil {

          private final MessageSource messageSource;

          public MessageUtil(MessageSource messageSource) {
              this.messageSource = messageSource;
          }

          public String get(String code){
              return messageSource.getMessage(code, null, LocaleContextHolder.getLocale());
          }
          public String get(String code, Object[] args){
              return messageSource.getMessage(code, args, LocaleContextHolder.getLocale());
          }

      }

* PostService.java

      package com.example.restful.service;

      import com.example.restful.dto.PostRequestDto;
      import com.example.restful.exception.HandlerPostNotFoundException;
      import com.example.restful.util.MessageUtil;
      import org.springframework.beans.factory.annotation.Autowired;
      import org.springframework.stereotype.Service;

      @Service
      public class PostService {

          @Autowired
          MessageUtil messageUtil;

          public String getPost(Long id){

              String msg = messageUtil.get("nodata");
              throw new HandlerPostNotFoundException(msg);
          }
      }



