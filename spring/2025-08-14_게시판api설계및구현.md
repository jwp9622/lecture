## Day7 실전 게시판 API 설계 및 구현(Java+Spring Boot 기준)

* 강의 개요   
실무형 게시판(Post) API 설계 구현   
CRUD 흐름 전체를 직접 구축   
RESTful URI 및 Controller 설계 훈련   
   
* 강의 내용   
Post 엔티티 설계 --> Repository --> Controller 구현   
Talend API Tester로 전 기능 테스트   
   
* 게시판 API 기능 명세   
게시글 목록 조회 --> GET --> /posts   
게시글 단건 조회 --> GET --> /posts/{id}   
게시글 등록 --> POST --> /posts   
게시글 수정 --> PUT --> /posts/{id}   
게시글 삭제 --> DELETE --> /posts/{id}   

* Post 엔티티 설계
		@Entity
		public class Post{
			@Id
			@GeneratedValue
			private Long id;

			@NotBlank
			private String title;

			@Lob
			private String content;
		}

		* PostRepository 정의
		public interface PostRepository extends JpaRepository<Post, Long>{
			
		}

* PostController - 등록, 조회 구현

		@ReseController
		@RequiredArgsconstructor
		@RequestMapping("/posts")
		public class PostController{
			private final PostRepository postRepository;

			@PostMapping
			public Post create(@RequestBody Post post){
				return postRepository.save(post);
			}
			@GetMapping
			public List<Post> findAll(){
				return postRepository.findAll();
			}
			@GetMapping("/{id}")
			public Post findOne(@PathVariable Long id){
				reutrn postRepository.findById(id).orElseThrow();
			}
			@PutMapping("/{id}")
			public Post update(@PathVariable Long id Long id, @RequestBody Post request){
				Post post = postRepository.findById(id).orElseThrow();
				post.setTitle(request.getTitle());
				post.setContent(request.getCotnent());
				return postRepository.save(post);
			}
			@DeleteMapping("/{id}")
			public void delete(@PathVariable Long id){
				postRepository.deleteById(id);
			}

		}


* Talend로 게시글 CRUD 테스트   
--> Talend를 통한 전체 API 호출 테스트   
   
POST /posts - 게시글 등록   
GET / posts -  전체 조회   
GET /posts/1 - 단건 조회   
PUT /posts/1 - 수정   
DELETE /posts/1 -삭제   
   
* 모니터링 도구(CPU + Memory + Network + Disk)   
- Actuator(엑츄에이터)   
- Grafana(그라파나)   
- Prometeus(프로메테우스)    
   
Server --> (metric)--> Prometeus -->(metric)--> Grafana   
   
   
* 모니터링 (CPU + Memory + Network)   
          
    Server -->(metric)--> Prometeus -->(metric)--> Grafana     
      

1. Spring Boot에서 다양한 모니터링 툴과 연동을 위해 사용하는 공통 측정 API는 무엇인가요?     

	--> Micrometer는 Prometheus를 포함한 다양한 백엔드와 연동 가능한 지표 수집 API입니다.   

2. Actuator에서 애플리케이션의 메트릭 데이터를 제공하는 엔드포인트
   
	--> /actuator/metrics는 애플리케이션 성능 측정을 위한 다양한 지표들을 제공합니다.

3. 성능 측정 도구
			
	--> Jmeter는 다수의 요청을 모의하여 성능을 검증
	--> Apache JMeter는 부하 테스트(Load Testing)와 성능 테스트(Performance Testing)를 위해 널리 사용되는 오픈소스 툴
	--> 웹 애플리케이션뿐만 아니라 API, 데이터베이스, FTP 서버 등 다양한 서비스의 처리 능력을 시뮬레이션하고 측정



## 실습 문제 10개

1. Post 엔티티 생성하기

	id, title, content 필드를 포함한 Post 엔티티를 생성하시오.

	title은 @NotBlank, content는 @Lob으로 지정할 것.


2. PostRepository 작성하기

	JpaRepository<Post, Long>을 상속하는 PostRepository를 작성하시오.

	추가 메서드는 작성하지 않는다.


3. 게시글 등록 API 구현

	URI: POST /posts

	요청 Body에 담긴 게시글 데이터를 저장하고, 저장된 게시글을 반환하는 컨트롤러 메서드를 작성하시오.


4. 전체 게시글 조회 API 구현

	URI: GET /posts

	DB에 저장된 모든 게시글을 리스트로 반환하는 컨트롤러 메서드를 작성하시오.


5. 단일 게시글 조회 API 구현

	URI: GET /posts/{id}

	id 경로 변수를 받아 해당 게시글을 조회하고, 존재하지 않으면 예외를 발생시키는 메서드를 작성하시오.


6. 게시글 수정 API 구현

	URI: PUT /posts/{id}

	요청 Body의 내용을 이용해 기존 게시글의 제목과 내용을 수정하고 저장하는 메서드를 작성하시오.


7. 게시글 삭제 API 구현

	URI: DELETE /posts/{id}

	지정한 ID의 게시글을 삭제하는 컨트롤러 메서드를 작성하시오.


8. Talend API Tester로 CRUD 테스트 시나리오 작성

	등록 → 전체 조회 → 단일 조회 → 수정 → 삭제 순서대로 API를 호출하고, 각 단계별 응답 예시를 작성하시오.


9. RESTful URI 설계 평가 문제

	다음 중 RESTful 규칙에 맞지 않는 URI를 찾아 RESTful하게 수정하시오.

	/createPost
	/posts
	/deletePost/{id}


10. 확장 기능 – 검색 API 구현 (도전)

	URI: GET /posts/search?keyword=xxx

	제목에 keyword가 포함된 게시글만 조회하는 메서드를 PostRepository와 컨트롤러에 구현하시오.


## 실습 문제 10개 풀이

1. Post 엔티티 생성하기

	id, title, content 필드를 포함한 Post 엔티티를 생성하시오.

	title은 @NotBlank, content는 @Lob으로 지정할 것.


2. PostRepository 작성하기

	JpaRepository<Post, Long>을 상속하는 PostRepository를 작성하시오.

	추가 메서드는 작성하지 않는다.


3. 게시글 등록 API 구현

	URI: POST /posts

	요청 Body에 담긴 게시글 데이터를 저장하고, 저장된 게시글을 반환하는 컨트롤러 메서드를 작성하시오.


4. 전체 게시글 조회 API 구현

	URI: GET /posts

	DB에 저장된 모든 게시글을 리스트로 반환하는 컨트롤러 메서드를 작성하시오.


5. 단일 게시글 조회 API 구현

	URI: GET /posts/{id}

	id 경로 변수를 받아 해당 게시글을 조회하고, 존재하지 않으면 예외를 발생시키는 메서드를 작성하시오.

6. 게시글 수정 API 구현

	URI: PUT /posts/{id}

	요청 Body의 내용을 이용해 기존 게시글의 제목과 내용을 수정하고 저장하는 메서드를 작성하시오.


7. 게시글 삭제 API 구현

	URI: DELETE /posts/{id}

	지정한 ID의 게시글을 삭제하는 컨트롤러 메서드를 작성하시오.


8. Talend API Tester로 CRUD 테스트 시나리오 작성

	등록 → 전체 조회 → 단일 조회 → 수정 → 삭제 순서대로 API를 호출하고, 각 단계별 응답 예시를 작성하시오.


9. RESTful URI 설계 평가 문제

	다음 중 RESTful 규칙에 맞지 않는 URI를 찾아 RESTful하게 수정하시오.

	/createPost
	/posts
	/deletePost/{id}


10. 확장 기능 – 검색 API 구현 (도전)

	URI: GET /posts/search?keyword=xxx

	제목에 keyword가 포함된 게시글만 조회하는 메서드를 PostRepository와 컨트롤러에 구현하시오.


## 실습 문제 10개 풀이

0) 프로젝트 필수 설정

* build.gradle 

		plugins {
			id 'java'
			id 'org.springframework.boot' version '3.3.2'
			id 'io.spring.dependency-management' version '1.1.6'
		}
		group = 'com.example'
		version = '0.0.1-SNAPSHOT'
		java { toolchain { languageVersion = JavaLanguageVersion.of(17) } }

		dependencies {
			implementation 'org.springframework.boot:spring-boot-starter-web'
			implementation 'org.springframework.boot:spring-boot-starter-validation'
			implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
			runtimeOnly 'com.h2database:h2'
			testImplementation 'org.springframework.boot:spring-boot-starter-test'
		}

* src/main/resources/application.yml

		spring:
		  datasource:
			url: jdbc:h2:mem:demo;MODE=MySQL;DB_CLOSE_DELAY=-1
			driverClassName: org.h2.Driver
			username: sa
			password:
		  jpa:
			hibernate:
			  ddl-auto: update
			open-in-view: false
			properties:
			  hibernate:
				format_sql: true
		  h2:
			console:
			  enabled: true
		logging.level.org.hibernate.SQL: info

* DemoApplication.java

		package com.example.demo;
		import org.springframework.boot.SpringApplication;
		import org.springframework.boot.autoconfigure.SpringBootApplication;

		@SpringBootApplication
		public class DemoApplication {
			public static void main(String[] args) {
			SpringApplication.run(DemoApplication.class, args);
			}
		}


1) Post 엔티티 생성 (문제 1 정답)

* domain/Post.java

		package com.example.demo.domain;
		import jakarta.persistence.*;
		import jakarta.validation.constraints.NotBlank;
		import lombok.Getter;
		import lombok.NoArgsConstructor;
		import lombok.Setter;
		@Entity
		@Getter @Setter
		@NoArgsConstructor
		public class Post {
			@Id @GeneratedValue(strategy = GenerationType.IDENTITY)
			private Long id;
			@NotBlank(message = "제목은 비어 있을 수 없습니다.")
			@Column(nullable = false, length = 200)
			private String title;
			@Lob
			private String content;
		}


2) PostRepository 작성 (문제 2 정답)
* repository/PostRepository.java

		package com.example.demo.repository;
		import com.example.demo.domain.Post;
		import org.springframework.data.jpa.repository.JpaRepository;
		import java.util.List;
		public interface PostRepository extends JpaRepository<Post, Long> {
			// 문제 10(검색)을 위해 추가
			List<Post> findByTitleContainingIgnoreCase(String keyword);
		}


3) 7) CRUD 컨트롤러 구현 (문제 37 정답)

* web/PostController.java

		package com.example.demo.web;

		import com.example.demo.domain.Post;
		import com.example.demo.repository.PostRepository;
		import jakarta.validation.Valid;
		import lombok.RequiredArgsConstructor;
		import org.springframework.http.HttpStatus;
		import org.springframework.web.bind.annotation.*;

		import java.util.List;

		@RestController
		@RequiredArgsConstructor
		@RequestMapping("/posts")
		public class PostController {

			private final PostRepository postRepository;

			// 게시글 등록 (문제 3)
			@PostMapping
			@ResponseStatus(HttpStatus.CREATED)
			public Post create(@Valid @RequestBody Post post) {
				return postRepository.save(post);
			}
		// 전체 조회 (문제 4)
			@GetMapping
			public List<Post> findAll() {
				return postRepository.findAll();
			}

			// 단건 조회 (문제 5)
			@GetMapping("/{id}")
			public Post findOne(@PathVariable Long id) {
				return postRepository.findById(id)
						.orElseThrow(() -> new ResourceNotFoundException("Post not found: " + id));
			}

			// 수정 (문제 6)
			@PutMapping("/{id}")
			public Post update(@PathVariable Long id, @Valid @RequestBody Post request) {
				Post post = postRepository.findById(id)
						.orElseThrow(() -> new ResourceNotFoundException("Post not found: " + id));
				post.setTitle(request.getTitle());
				post.setContent(request.getContent());
				return postRepository.save(post);
			}
		// 삭제 (문제 7)
			@DeleteMapping("/{id}")
			@ResponseStatus(HttpStatus.NO_CONTENT)
			public void delete(@PathVariable Long id) {
				if (!postRepository.existsById(id)) {
					throw new ResourceNotFoundException("Post not found: " + id);
				}
				postRepository.deleteById(id);
			}

			// 검색 (문제 10)
			@GetMapping("/search")
			public List<Post> search(@RequestParam String keyword) {
				return postRepository.findByTitleContainingIgnoreCase(keyword);
			}
		}

* web/ResourceNotFoundException.java

		package com.example.demo.web;

		public class ResourceNotFoundException extends RuntimeException {
			public ResourceNotFoundException(String message) { super(message); }
		}

* web/GlobalExceptionHandler.java (예외 및 검증 응답 정리)
		package com.example.demo.web;

		import org.springframework.http.HttpStatus;
		import org.springframework.http.ResponseEntity;
		import org.springframework.validation.FieldError;
		import org.springframework.web.bind.MethodArgumentNotValidException;
		import org.springframework.web.bind.annotation.*;

		import java.time.Instant;
		import java.util.HashMap;
		import java.util.Map;

		@RestControllerAdvice
		public class GlobalExceptionHandler {

			@ExceptionHandler(ResourceNotFoundException.class)
			public ResponseEntity<?> notFound(ResourceNotFoundException e) {
				Map<String,Object> body = new HashMap<>();
				body.put("timestamp", Instant.now().toString());
				body.put("status", 404);
				body.put("error", "Not Found");
				body.put("message", e.getMessage());
				return ResponseEntity.status(HttpStatus.NOT_FOUND).body(body);
			}
		@ExceptionHandler(MethodArgumentNotValidException.class)
			public ResponseEntity<?> invalid(MethodArgumentNotValidException e) {
				Map<String,Object> body = new HashMap<>();
				body.put("timestamp", Instant.now().toString());
				body.put("status", 400);
				body.put("error", "Bad Request");
				Map<String, String> errors = new HashMap<>();
				for (FieldError fe : e.getBindingResult().getFieldErrors()) {
					errors.put(fe.getField(), fe.getDefaultMessage());
				}
				body.put("validationErrors", errors);
				return ResponseEntity.badRequest().body(body);
			}
		}


8) Talend API Tester CRUD 시나리오 (문제 8 정답)
		요청/응답 예시는 로컬 http://localhost:8080 기준.
		등록 – POST /posts


		URL: http://localhost:8080/posts
		Headers: Content-Type: application/json
		Body:
		{
		  "title": "첫 글",
		  "content": "안녕하세요, 첫 글 내용입니다."
		}
		예상 응답(201):
		{
		  "id": 1,
		  "title": "첫 글",
		  "content": "안녕하세요, 첫 글 내용입니다."
		}
		전체 조회 – GET /posts


		URL: http://localhost:8080/posts
		예상 응답(200):
		[
		  {
			"id": 1,
			"title": "첫 글",
			"content": "안녕하세요, 첫 글 내용입니다."
		  }
		]

		단건 조회 – GET /posts/1


		URL: http://localhost:8080/posts/1
		예상 응답(200):
		{
		  "id": 1,
		  "title": "첫 글",
		  "content": "안녕하세요, 첫 글 내용입니다."
		}
		수정 – PUT /posts/1


		URL: http://localhost:8080/posts/1
		Headers: Content-Type: application/json
		Body:
		{
		  "title": "제목 수정",
		  "content": "내용 수정"
		}
		예상 응답(200):
		{
		  "id": 1,
		  "title": "제목 수정",
		  "content": "내용 수정"
		}
		삭제 – DELETE /posts/1


		URL: http://localhost:8080/posts/1
		예상 응답: 204 No Content (Body 없음)

		검증 – 삭제 후 단건 조회


		GET /posts/1 → 404 Not Found
		예상 에러 바디:
		{
		  "timestamp": "...",
		  "status": 404,
		  "error": "Not Found",
		  "message": "Post not found: 1"
		}


9) RESTful URI 설계 평가 (문제 9 정답)
		잘못된 URI: /createPost, /deletePost/{id}

		수정안: 생성은 POST /posts, 삭제는 DELETE /posts/{id}

		올바른 URI: /posts


10) 확장 – 검색 API (문제 10 정답)
		이미 컨트롤러/레포지토리에 반영됨. 사용 예시:
		GET /posts/search?keyword=첫
		예상 응답:
		[
		  {
			"id": 1,
			"title": "첫 글",
			"content": "안녕하세요, 첫 글 내용입니다."
		  }
		]
		(옵션) 빠른 cURL 테스트 모음


### 생성
		curl -X POST http://localhost:8080/posts \
		  -H "Content-Type: application/json" \
		  -d '{"title":"첫 글","content":"내용"}'
		# 전체 조회
		curl http://localhost:8080/posts
		# 단건 조회
		curl http://localhost:8080/posts/1
		# 수정
		curl -X PUT http://localhost:8080/posts/1 \
		  -H "Content-Type: application/json" \
		  -d '{"title":"수정 제목","content":"수정 내용"}'
		# 삭제
		curl -X DELETE http://localhost:8080/posts/1
		# 검색
		curl "http://localhost:8080/posts/search?keyword=수정"